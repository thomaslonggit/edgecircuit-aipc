# ğŸš€ Verilog ä¼˜åŒ–å·¥å…·ä½¿ç”¨æŒ‡å—

## é—®é¢˜è§£å†³æ–¹æ¡ˆ

ä½ é‡åˆ°çš„**ä»£ç å†—é•¿ä¸”ä¸å¯è¯»**çš„é—®é¢˜å·²ç»å®Œå…¨è§£å†³ï¼æ–°ç‰ˆæœ¬æä¾›äº†4ç§ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥ã€‚

### ğŸ” é—®é¢˜åŸå› åˆ†æ

åŸå§‹ä»£ç äº§ç”Ÿå†—é•¿è¾“å‡ºçš„æ ¹æœ¬åŸå› ï¼š
1. **AIG è½¬æ¢**ï¼šå°†é€»è¾‘è½¬æ¢ä¸ºåªæœ‰ AND é—¨å’Œåç›¸å™¨çš„ä½çº§è¡¨ç¤º
2. **ç»“æ„ä¸¢å¤±**ï¼šé«˜çº§ç»“æ„ï¼ˆåŠ æ³•å™¨ã€å¤šè·¯é€‰æ‹©å™¨ï¼‰è¢«åˆ†è§£ä¸ºåŸºæœ¬é—¨
3. **ä¿¡å·å‘½å**ï¼šç”Ÿæˆå¤§é‡æ— æ„ä¹‰çš„å†…éƒ¨ä¿¡å·åï¼ˆå¦‚ `n100`, `n101_inv`ï¼‰

## ğŸ†• æ–°çš„ä¼˜åŒ–ç­–ç•¥

### 1. `readable` ç­–ç•¥ â­ **æ¨è**
```bash
python vop.py your_design.v --strategy readable
```
**ç‰¹ç‚¹ï¼š**
- âœ… ä¿æŒé«˜çº§ç»“æ„ï¼ˆåŠ æ³•å™¨ã€å¤šè·¯é€‰æ‹©å™¨ç­‰ï¼‰
- âœ… æœ‰æ„ä¹‰çš„ä¿¡å·å‘½å
- âœ… é¿å…å¤§é‡å†…éƒ¨ wire å£°æ˜
- âœ… ä½¿ç”¨ `alumacc` è¯†åˆ«ç®—æœ¯æ¨¡å¼

**é€‚ç”¨åœºæ™¯ï¼š** æ—¥å¸¸å¼€å‘ï¼Œéœ€è¦äººå·¥ç»´æŠ¤çš„ä»£ç 

### 2. `balanced` ç­–ç•¥
```bash
python vop.py your_design.v --strategy balanced
```
**ç‰¹ç‚¹ï¼š**
- ğŸ”„ åœ¨é¢ç§¯å’Œå¯è¯»æ€§ä¹‹é—´å¹³è¡¡
- ğŸ”„ ç»“åˆ ABC å’Œ Yosys ä¼˜åŒ–
- ğŸ”„ é€‚åº¦çš„ç»“æ„ç®€åŒ–

**é€‚ç”¨åœºæ™¯ï¼š** å¯¹é¢ç§¯æœ‰è¦æ±‚ä½†ä»éœ€è¦ä¸€å®šå¯è¯»æ€§

### 3. `yosys_only` ç­–ç•¥
```bash
python vop.py your_design.v --strategy yosys_only
```
**ç‰¹ç‚¹ï¼š**
- ğŸ¯ çº¯ Yosys ä¼˜åŒ–ï¼Œä¸ä½¿ç”¨ ABC
- ğŸ¯ é¿å… AIG è½¬æ¢
- ğŸ¯ ä¿æŒ Verilog çº§åˆ«çš„ç»“æ„

**é€‚ç”¨åœºæ™¯ï¼š** ABC å·¥å…·ä¸å¯ç”¨æˆ–æœ‰å…¼å®¹æ€§é—®é¢˜

### 4. `aig` ç­–ç•¥ âš ï¸ **ä¸æ¨èç”¨äºå¯è¯»æ€§**
```bash
python vop.py your_design.v --strategy aig
```
**ç‰¹ç‚¹ï¼š**
- âŒ ä½ é‡åˆ°çš„åŸå§‹æ–¹æ³•
- âŒ ä¼šäº§ç”Ÿå¤§é‡å†—é•¿ä»£ç 
- âœ… åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½è·å¾—æœ€å°çš„é—¨æ•°é‡

**é€‚ç”¨åœºæ™¯ï¼š** ä»…å½“æåº¦è¿½æ±‚æœ€å°é¢ç§¯ä¸”ä¸å…³å¿ƒå¯è¯»æ€§æ—¶ä½¿ç”¨

## ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨ï¼ˆæ¨èï¼‰
```bash
# ä½¿ç”¨å¯è¯»æ€§ä¼˜åŒ–ï¼ˆé»˜è®¤ï¼‰
python vop.py my_design.v --strategy readable

# æŒ‡å®šé¡¶å±‚æ¨¡å—
python vop.py my_design.v --top my_module --strategy readable

# è‡ªå®šä¹‰ä¼˜åŒ–å‚æ•°
python vop.py my_design.v --strategy readable \
    --n-trials 100 \
    --seq-len 8 \
    --delay-w 0.15
```

### å¯¹æ¯”ä¸åŒç­–ç•¥
```bash
# æµ‹è¯•å¯è¯»æ€§ç­–ç•¥
python vop.py test.v --strategy readable --out-dir results_readable

# æµ‹è¯•å¹³è¡¡ç­–ç•¥  
python vop.py test.v --strategy balanced --out-dir results_balanced

# å¯¹æ¯”ç»“æœ
ls results_readable/best_opt.v results_balanced/best_opt.v
```

## ğŸ”§ è¾“å‡ºæ–‡ä»¶è¯´æ˜

### `readable` ç­–ç•¥è¾“å‡º
```
bo_out/
â”œâ”€â”€ baseline_readable.v    # åŸºç¡€å¯è¯»ç‰ˆæœ¬
â””â”€â”€ best_opt.v            # ä¼˜åŒ–åçš„å¯è¯»ç‰ˆæœ¬
```

### å…¶ä»–ç­–ç•¥è¾“å‡º
```
bo_out/
â”œâ”€â”€ golden.aig           # åŸå§‹ AIG æ–‡ä»¶ï¼ˆå¦‚é€‚ç”¨ï¼‰
â”œâ”€â”€ best.aig            # ä¼˜åŒ–å AIGï¼ˆå¦‚é€‚ç”¨ï¼‰
â””â”€â”€ best_opt.v          # ä¼˜åŒ–å Verilog
```

## ğŸ“Š æ•ˆæœå¯¹æ¯”

### å…¸å‹è¾“å‡ºå¯¹æ¯”

**åŸå§‹ AIG æ–¹æ³•äº§ç”Ÿçš„ä»£ç ï¼š**
```verilog
// æ•°ç™¾è¡Œç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼š
wire n100;
wire n100_inv; 
wire n101;
wire n101_inv;
// ... æ›´å¤šæ— æ„ä¹‰çš„ä¿¡å·
assign n34 = n33_inv & n29_inv;
assign n124 = n123_inv & n68_inv;
// ... å¤§é‡åŸºæœ¬é—¨è¿æ¥
```

**æ–°çš„ readable ç­–ç•¥äº§ç”Ÿçš„ä»£ç ï¼š**
```verilog
module sample_adder (
    input [7:0] a, b, c,
    output [7:0] sum,
    output [7:0] product_low
);
    // ä¿æŒåŸå§‹ç»“æ„çš„æ¸…æ™°è¡¨è¾¾
    assign sum = a + b + c;
    assign product_low = a * b;
endmodule
```

## ğŸ› ï¸ å¿«é€Ÿæµ‹è¯•

è¿è¡Œæ¼”ç¤ºè„šæœ¬æ¥æŸ¥çœ‹æ•ˆæœï¼š
```bash
python demo_readable.py
```

è¿™å°†ï¼š
1. åˆ›å»ºä¸€ä¸ªæµ‹è¯•è®¾è®¡
2. å¯¹æ¯”ä¸åŒç­–ç•¥çš„è¾“å‡º
3. æ˜¾ç¤ºä»£ç ç¤ºä¾‹å’Œç»Ÿè®¡ä¿¡æ¯

## âš¡ æ€§èƒ½å»ºè®®

### å‚æ•°è°ƒä¼˜
- **è¯•éªŒæ¬¡æ•° (`-n`)**: 
  - å¿«é€Ÿæµ‹è¯•: 20-50
  - æ—¥å¸¸ä½¿ç”¨: 60-100  
  - ç²¾ç»†ä¼˜åŒ–: 200+

- **åºåˆ—é•¿åº¦ (`-l`)**:
  - ç®€å•è®¾è®¡: 4-6
  - å¤æ‚è®¾è®¡: 6-10
  - è¶…å¤§è®¾è®¡: 8-12

- **å»¶è¿Ÿæƒé‡ (`-w`)**:
  - é¢ç§¯ä¼˜å…ˆ: 0.05-0.1
  - å¹³è¡¡: 0.1-0.2
  - é€Ÿåº¦ä¼˜å…ˆ: 0.3-0.5

### æœ€ä½³å®è·µ

1. **å¼€å‘é˜¶æ®µ**ï¼šä½¿ç”¨ `readable` ç­–ç•¥
2. **éªŒè¯é˜¶æ®µ**ï¼šå¯¹æ¯” `balanced` å’Œ `readable`
3. **é‡äº§é˜¶æ®µ**ï¼šæ ¹æ®éœ€æ±‚é€‰æ‹©æœ€ç»ˆç­–ç•¥

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: å¯è¯»æ€§ç­–ç•¥ä¼˜åŒ–å¤±è´¥ï¼Ÿ**
A: æ£€æŸ¥è®¾è®¡æ˜¯å¦åŒ…å«æ—¶åºé€»è¾‘ï¼ŒAIG åªæ”¯æŒç»„åˆé€»è¾‘

**Q: è¾“å‡ºä»ç„¶ä¸å¤Ÿå¯è¯»ï¼Ÿ**
A: å°è¯• `yosys_only` ç­–ç•¥ï¼Œæˆ–å‡å°‘ä¼˜åŒ–å¼ºåº¦

**Q: æƒ³è¦æ›´å°çš„é¢ç§¯ï¼Ÿ**
A: ä½¿ç”¨ `balanced` ç­–ç•¥ï¼Œæˆ–å¢åŠ è¯•éªŒæ¬¡æ•°

### è°ƒè¯•æŠ€å·§
```bash
# å¯ç”¨è¯¦ç»†è¾“å‡º
python vop.py design.v --strategy readable -n 10 2>&1 | tee optimization.log

# æ£€æŸ¥ä¸­é—´æ–‡ä»¶
ls bo_out/
head -50 bo_out/best_opt.v
```

## ğŸ¯ æ€»ç»“

âœ… **è§£å†³äº†ä½ çš„é—®é¢˜**ï¼šä¸å†ç”Ÿæˆå†—é•¿éš¾è¯»çš„ä»£ç 
âœ… **æ¨èä½¿ç”¨**ï¼š`--strategy readable`ï¼ˆé»˜è®¤ï¼‰
âœ… **å‘åå…¼å®¹**ï¼šåŸæœ‰çš„ `aig` æ–¹æ³•ä»ç„¶å¯ç”¨
âœ… **çµæ´»é€‰æ‹©**ï¼š4ç§ç­–ç•¥é€‚åº”ä¸åŒéœ€æ±‚

**ç«‹å³å¼€å§‹ä½¿ç”¨ï¼š**
```bash
python vop.py your_design.v --strategy readable
```

äº«å—æ¸…æ™°å¯è¯»çš„ä¼˜åŒ–ç»“æœï¼ğŸ‰ 